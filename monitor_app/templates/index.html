<!DOCTYPE html>
<html>
<head>
    <title>Clone Detector Statistics</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        canvas {
            max-width: 900px;
            margin: 30px auto;
            display: block;
        }
    </style>
</head>
<body>

<h2 align="center">Clone Detector Monitoring</h2>

<canvas id="filesChart"></canvas>
<canvas id="chunksChart"></canvas>
<canvas id="candidatesChart"></canvas>
<canvas id="clonesChart"></canvas>

<script>
let charts = {};

function createChart(canvasId, label) {
  const ctx = document.getElementById(canvasId).getContext("2d");
  charts[canvasId] = new Chart(ctx, {
    type: "line",
    data: {
      labels: [],
      datasets: [{
        label: label,
        data: [],
        borderWidth: 2,
        fill: false
      }]
    },
    options: {
      responsive: true,
      animation: false,
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });
}

function updateCharts() {
  fetch("/data")
    .then(res => res.json())
    .then(data => {
      const labels = data.timestamps.map(t =>
        new Date(t).toLocaleTimeString()
      );

      charts.filesChart.data.labels = labels;
      charts.filesChart.data.datasets[0].data = data.files;

      charts.chunksChart.data.labels = labels;
      charts.chunksChart.data.datasets[0].data = data.chunks;

      charts.candidatesChart.data.labels = labels;
      charts.candidatesChart.data.datasets[0].data = data.candidates;

      charts.clonesChart.data.labels = labels;
      charts.clonesChart.data.datasets[0].data = data.clones;

      Object.values(charts).forEach(chart => chart.update());
    });
}

createChart("filesChart", "Files Processed");
createChart("chunksChart", "Chunks Generated");
createChart("candidatesChart", "Clone Candidates");
createChart("clonesChart", "Confirmed Clones");

// Refresh every 5 seconds
updateCharts();
setInterval(updateCharts, 5000);
</script>

</body>
</html>
