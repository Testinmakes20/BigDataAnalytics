#!/usr/bin/perl -w

use strict;

if ($ARGV[0] eq "-list") {
	my @list = list_names($ARGV[1]);
	printf("@list");
} elsif ($ARGV[0] eq "-reduced") {
	my $destination = $ARGV[1];
	install_reduced($destination);
} else {
	my $destination = $ARGV[0];
	install_reduced($destination);
}

sub install_reduced {
	my ($corpusdir) = @_;
	my $src = "apache-jmeter-2.9_src.tgz";
	my $bin = "apache-jmeter-2.9.tgz";
	my @files = ("apache-jmeter-2.9/lib/jcharts-0.7.5.jar","apache-jmeter-2.9/lib/excalibur-pool-1.2.jar","apache-jmeter-2.9/lib/excalibur-instrument-1.0.jar","apache-jmeter-2.9/bin/ApacheJMeter.jar","apache-jmeter-2.9/lib/httpcore-4.2.3.jar","apache-jmeter-2.9/lib/ext/ApacheJMeter_ldap.jar","apache-jmeter-2.9/lib/tika-core-1.3.jar","apache-jmeter-2.9/lib/commons-jexl-1.1.jar","apache-jmeter-2.9/lib/jodd-core-3.4.1.jar","apache-jmeter-2.9/lib/mail-1.4.4.jar","apache-jmeter-2.9/lib/junit-4.10.jar","apache-jmeter-2.9/lib/xalan-2.7.1.jar","apache-jmeter-2.9/lib/jdom-1.1.2.jar","apache-jmeter-2.9/lib/oro-2.0.8.jar","apache-jmeter-2.9/lib/ext/ApacheJMeter_http.jar","apache-jmeter-2.9/lib/commons-io-2.2.jar","apache-jmeter-2.9/lib/ext/ApacheJMeter_mail.jar","apache-jmeter-2.9/lib/jtidy-r938.jar","apache-jmeter-2.9/lib/commons-httpclient-3.1.jar","apache-jmeter-2.9/lib/ext/ApacheJMeter_ftp.jar","apache-jmeter-2.9/lib/jorphan.jar","apache-jmeter-2.9/lib/ext/ApacheJMeter_jms.jar","apache-jmeter-2.9/lib/xmlgraphics-commons-1.3.1.jar","apache-jmeter-2.9/lib/soap-2.3.1.jar","apache-jmeter-2.9/lib/commons-lang-2.6.jar","apache-jmeter-2.9/lib/xstream-1.4.2.jar","apache-jmeter-2.9/lib/ext/ApacheJMeter_tcp.jar","apache-jmeter-2.9/lib/commons-lang3-3.1.jar","apache-jmeter-2.9/lib/xpp3_min-1.1.4c.jar","apache-jmeter-2.9/lib/ext/ApacheJMeter_junit.jar","apache-jmeter-2.9/extras/ant-jmeter-1.1.1.jar","apache-jmeter-2.9/lib/junit/test.jar","apache-jmeter-2.9/lib/ext/ApacheJMeter_jdbc.jar","apache-jmeter-2.9/lib/htmllexer-2.1.jar","apache-jmeter-2.9/lib/xml-apis-1.3.04.jar","apache-jmeter-2.9/lib/commons-net-3.1.jar","apache-jmeter-2.9/lib/ext/ApacheJMeter_report.jar","apache-jmeter-2.9/lib/htmlparser-2.1.jar","apache-jmeter-2.9/lib/serializer-2.7.1.jar","apache-jmeter-2.9/lib/ext/ApacheJMeter_components.jar","apache-jmeter-2.9/lib/bshclient.jar","apache-jmeter-2.9/lib/xercesImpl-2.9.1.jar","apache-jmeter-2.9/lib/commons-codec-1.6.jar","apache-jmeter-2.9/lib/bsh-2.0b5.jar","apache-jmeter-2.9/lib/httpclient-4.2.3.jar","apache-jmeter-2.9/lib/slf4j-api-1.7.2.jar","apache-jmeter-2.9/lib/rhino-1.7R4.jar","apache-jmeter-2.9/lib/geronimo-jms_1.1_spec-1.1.1.jar","apache-jmeter-2.9/lib/httpmime-4.2.3.jar","apache-jmeter-2.9/lib/ext/ApacheJMeter_functions.jar","apache-jmeter-2.9/lib/commons-jexl-2.1.1.jar","apache-jmeter-2.9/lib/commons-logging-1.1.1.jar","apache-jmeter-2.9/lib/bsf-2.4.0.jar","apache-jmeter-2.9/lib/avalon-framework-4.1.4.jar","apache-jmeter-2.9/lib/ext/ApacheJMeter_monitors.jar","apache-jmeter-2.9/lib/xmlpull-1.1.3.1.jar","apache-jmeter-2.9/lib/commons-collections-3.2.1.jar","apache-jmeter-2.9/lib/excalibur-datasource-1.1.1.jar","apache-jmeter-2.9/lib/jodd-lagarto-3.4.1.jar","apache-jmeter-2.9/lib/jsoup-1.7.1.jar","apache-jmeter-2.9/lib/excalibur-logger-1.1.jar","apache-jmeter-2.9/lib/ext/ApacheJMeter_core.jar","apache-jmeter-2.9/lib/ext/ApacheJMeter_java.jar","apache-jmeter-2.9/lib/ext/ApacheJMeter_native.jar","apache-jmeter-2.9/lib/activation-1.1.1.jar","apache-jmeter-2.9/lib/logkit-2.0.jar","apache-jmeter-2.9/lib/tika-parsers-1.3.jar");
	printf("\t\t unpacking $src\n");
	system("tar zxf $corpusdir/compressed/$src -C $corpusdir/src\n") == 0 or die "Failed to extract $src\n";
	printf("\t\t unpacking $bin\n");
	system("tar zxf $corpusdir/compressed/$bin -C $corpusdir/bin @files\n") == 0 or die "Failed to extract $bin\n";
}

sub list_names {
	my ($appverdir) = @_;
	opendir(COMPRESSED, "$appverdir/compressed") || die "can't open $appverdir/compressed: $!";
	my @archives = grep {! /^\.$/ and ! /^\.\.$/ } readdir(COMPRESSED);
	close(COMPRESSED);
	return @archives;
}
