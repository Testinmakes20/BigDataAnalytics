#!/usr/bin/perl -w

use strict;

if ($ARGV[0] eq "-list") {
	my @list = list_names($ARGV[1]);
	printf("@list");
} elsif ($ARGV[0] eq "-reduced") {
	my $destination = $ARGV[1];
	install_reduced($destination);
} else {
	my $destination = $ARGV[0];
	install_reduced($destination);
}

sub install_reduced {
	my ($corpusdir) = @_;
	my $src = "mvnforum-1.2.2-mvnad-1.0.1-src-20100817.zip";
	my $bin = "mvnforum-1.2.2-mvnad-1.0.1-bin-20100817.zip";
	my @files = ("mvnforum-1.2.2-mvnad-1.0.1-bin-20100817/webapp_mvnforum_only/WEB-INF/lib/lucene-core-2.4.1.jar","mvnforum-1.2.2-mvnad-1.0.1-bin-20100817/webapp_mvnforum_only/WEB-INF/lib/jaxen-1.1.1.jar","mvnforum-1.2.2-mvnad-1.0.1-bin-20100817/webapp_mvnforum_only/WEB-INF/lib/commons-digester.jar","mvnforum-1.2.2-mvnad-1.0.1-bin-20100817/webapp_mvnforum_only/WEB-INF/lib/concurrent-1.3.4.jar","mvnforum-1.2.2-mvnad-1.0.1-bin-20100817/webapp_mvnforum_only/WEB-INF/lib/freemarker.jar","mvnforum-1.2.2-mvnad-1.0.1-bin-20100817/webapp_mvnforum_only/WEB-INF/lib/commons-codec-1.3.jar","mvnforum-1.2.2-mvnad-1.0.1-bin-20100817/webapp_mvnforum_only/WEB-INF/lib/dom4j-1.6.1.jar","mvnforum-1.2.2-mvnad-1.0.1-bin-20100817/webapp_mvnforum_only/WEB-INF/lib/log4j-1.2.15.jar","mvnforum-1.2.2-mvnad-1.0.1-bin-20100817/webapp_mvnforum_only/WEB-INF/lib/commons-io-1.4.jar","mvnforum-1.2.2-mvnad-1.0.1-bin-20100817/driver/jtds-1.2.2.jar","mvnforum-1.2.2-mvnad-1.0.1-bin-20100817/webapp_mvnforum_only/WEB-INF/lib/jstl.jar","mvnforum-1.2.2-mvnad-1.0.1-bin-20100817/webapp_mvnforum_only/WEB-INF/lib/jcaptcha-all-1.0-RC6.jar","mvnforum-1.2.2-mvnad-1.0.1-bin-20100817/webapp_mvnforum_only/WEB-INF/lib/dnsjava-2.0.5.jar","mvnforum-1.2.2-mvnad-1.0.1-bin-20100817/webapp_mvnforum_only/WEB-INF/lib/commonj-twm.jar","mvnforum-1.2.2-mvnad-1.0.1-bin-20100817/webapp_mvnforum_only/WEB-INF/lib/standard.jar","mvnforum-1.2.2-mvnad-1.0.1-bin-20100817/webapp_mvnforum_only/WEB-INF/lib/commons-lang-2.3.jar","mvnforum-1.2.2-mvnad-1.0.1-bin-20100817/webapp_mvnforum_only/WEB-INF/lib/myvietnam.jar","mvnforum-1.2.2-mvnad-1.0.1-bin-20100817/webapp_mvnforum_only/WEB-INF/lib/mvnforum.jar","mvnforum-1.2.2-mvnad-1.0.1-bin-20100817/driver/mysql-connector-java-5.0.8-bin.jar","mvnforum-1.2.2-mvnad-1.0.1-bin-20100817/driver/mysql-connector-java-3.0.17-ga-bin.jar","mvnforum-1.2.2-mvnad-1.0.1-bin-20100817/driver/hsqldb.jar","mvnforum-1.2.2-mvnad-1.0.1-bin-20100817/webapp_mvnforum_with_mvnad/WEB-INF/lib/mvnad.jar","mvnforum-1.2.2-mvnad-1.0.1-bin-20100817/webapp_mvnforum_only/WEB-INF/lib/commons-logging-1.1.1.jar","mvnforum-1.2.2-mvnad-1.0.1-bin-20100817/webapp_mvnforum_only/WEB-INF/lib/pager-taglib.jar","mvnforum-1.2.2-mvnad-1.0.1-bin-20100817/driver/postgresql-8.3-603.jdbc3.jar","mvnforum-1.2.2-mvnad-1.0.1-bin-20100817/webapp_mvnforum_only/WEB-INF/lib/jakarta-regexp-1.2.jar","mvnforum-1.2.2-mvnad-1.0.1-bin-20100817/driver/mysql-connector-java-3.1.14-bin.jar","mvnforum-1.2.2-mvnad-1.0.1-bin-20100817/webapp_mvnforum_only/WEB-INF/lib/commons-collections.jar","mvnforum-1.2.2-mvnad-1.0.1-bin-20100817/webapp_mvnforum_only/WEB-INF/lib/activation.jar","mvnforum-1.2.2-mvnad-1.0.1-bin-20100817/webapp_mvnforum_only/WEB-INF/lib/jzonic.jar","mvnforum-1.2.2-mvnad-1.0.1-bin-20100817/webapp_mvnforum_only/WEB-INF/lib/whirlycache-1.0.1.jar","mvnforum-1.2.2-mvnad-1.0.1-bin-20100817/webapp_mvnforum_only/WEB-INF/lib/mail.jar","mvnforum-1.2.2-mvnad-1.0.1-bin-20100817/webapp_mvnforum_only/WEB-INF/lib/commons-beanutils-1.7.0.jar","mvnforum-1.2.2-mvnad-1.0.1-bin-20100817/webapp_mvnforum_only/WEB-INF/lib/aspirin.jar");
	printf("\t\t unpacking $src\n");
	system("unzip -qo $corpusdir/compressed/$src -d $corpusdir/src\n") == 0 or die "Failed to extract $src\n";
	printf("\t\t unpacking $bin\n");
	system("unzip -qo $corpusdir/compressed/$bin @files -d $corpusdir/bin\n") == 0 or die "Failed to extract $bin\n";
}

sub list_names {
	my ($appverdir) = @_;
	opendir(COMPRESSED, "$appverdir/compressed") || die "can't open $appverdir/compressed: $!";
	my @archives = grep {! /^\.$/ and ! /^\.\.$/ } readdir(COMPRESSED);
	close(COMPRESSED);
	return @archives;
}
