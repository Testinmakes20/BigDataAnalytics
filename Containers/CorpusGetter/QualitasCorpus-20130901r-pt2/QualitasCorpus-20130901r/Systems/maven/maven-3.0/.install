#!/usr/bin/perl -w

use strict;

if ($ARGV[0] eq "-list") {
	my @list = list_names($ARGV[1]);
	printf("@list");
} elsif ($ARGV[0] eq "-reduced") {
	my $destination = $ARGV[1];
	install_reduced($destination);
} else {
	my $destination = $ARGV[0];
	install_reduced($destination);
}

sub install_reduced {
	my ($corpusdir) = @_;
	my $src = "apache-maven-3.0-src.zip";
	my $bin = "apache-maven-3.0-bin.zip";
	my @files = ("apache-maven-3.0/lib/aether-spi-1.7.jar","apache-maven-3.0/lib/aether-util-1.7.jar","apache-maven-3.0/lib/xercesMinimal-1.9.6.2.jar","apache-maven-3.0/lib/wagon-http-shared-1.0-beta-6.jar","apache-maven-3.0/lib/maven-core-3.0.jar","apache-maven-3.0/lib/aether-impl-1.7.jar","apache-maven-3.0/lib/plexus-sec-dispatcher-1.3.jar","apache-maven-3.0/lib/wagon-http-lightweight-1.0-beta-6.jar","apache-maven-3.0/lib/maven-aether-provider-3.0.jar","apache-maven-3.0/lib/sisu-inject-plexus-1.4.2.jar","apache-maven-3.0/lib/sisu-guice-2.1.7-noaop.jar","apache-maven-3.0/lib/maven-plugin-api-3.0.jar","apache-maven-3.0/lib/maven-model-3.0.jar","apache-maven-3.0/lib/plexus-utils-2.0.4.jar","apache-maven-3.0/lib/plexus-component-annotations-1.5.5.jar","apache-maven-3.0/lib/nekohtml-1.9.6.2.jar","apache-maven-3.0/lib/wagon-provider-api-1.0-beta-6.jar","apache-maven-3.0/lib/aether-connector-wagon-1.7.jar","apache-maven-3.0/lib/maven-settings-builder-3.0.jar","apache-maven-3.0/lib/maven-repository-metadata-3.0.jar","apache-maven-3.0/lib/maven-model-builder-3.0.jar","apache-maven-3.0/lib/wagon-file-1.0-beta-6.jar","apache-maven-3.0/lib/maven-embedder-3.0.jar","apache-maven-3.0/lib/commons-cli-1.2.jar","apache-maven-3.0/lib/plexus-interpolation-1.14.jar","apache-maven-3.0/lib/maven-settings-3.0.jar","apache-maven-3.0/lib/maven-compat-3.0.jar","apache-maven-3.0/lib/aether-api-1.7.jar","apache-maven-3.0/lib/maven-artifact-3.0.jar","apache-maven-3.0/lib/plexus-cipher-1.4.jar","apache-maven-3.0/lib/sisu-inject-bean-1.4.2.jar","apache-maven-3.0/boot/plexus-classworlds-2.2.3.jar");
	printf("\t\t unpacking $src\n");
	system("unzip -qo $corpusdir/compressed/$src -d $corpusdir/src\n") == 0 or die "Failed to extract $src\n";
	printf("\t\t unpacking $bin\n");
	system("unzip -qo $corpusdir/compressed/$bin @files -d $corpusdir/bin\n") == 0 or die "Failed to extract $bin\n";
}

sub list_names {
	my ($appverdir) = @_;
	opendir(COMPRESSED, "$appverdir/compressed") || die "can't open $appverdir/compressed: $!";
	my @archives = grep {! /^\.$/ and ! /^\.\.$/ } readdir(COMPRESSED);
	close(COMPRESSED);
	return @archives;
}
