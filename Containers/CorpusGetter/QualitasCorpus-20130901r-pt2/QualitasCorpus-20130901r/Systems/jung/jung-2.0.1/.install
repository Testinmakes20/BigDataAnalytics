#!/usr/bin/perl -w

use strict;

if ($ARGV[0] eq "-list") {
	my @list = list_names($ARGV[1]);
	printf("@list");
} elsif ($ARGV[0] eq "-reduced") {
	my $destination = $ARGV[1];
	install_reduced($destination);
} else {
	my $destination = $ARGV[0];
	install_reduced($destination);
}

sub install_reduced {
	my ($corpusdir) = @_;
	my $src = "jung2-2_0_1-sources.zip";
	my $bin = "jung2-2_0_1.zip";
	my @files = ("jung-3d-2.0.1.jar","stax-api-1.0.1.jar","jung-visualization-2.0.1.jar","collections-generic-4.01.jar","jung-algorithms-2.0.1.jar","j3d-core-1.3.1.jar","vecmath-1.3.1.jar","concurrent-1.3.4.jar","jung-samples-2.0.1.jar","jung-3d-demos-2.0.1.jar","jung-jai-samples-2.0.1.jar","jung-jai-2.0.1.jar","jung-graph-impl-2.0.1.jar","colt-1.2.0.jar","wstx-asl-3.2.6.jar","jung-io-2.0.1.jar","jung-api-2.0.1.jar");
	printf("\t\t unpacking $src\n");
	system("unzip -qo $corpusdir/compressed/$src -d $corpusdir/src\n") == 0 or die "Failed to extract the src $src\n";

        #unpack second level for source
        my %files = (
            "jung-3d-2.0.1-sources.jar" => "jung-3d-2.0.1",
            "jung-3d-demos-2.0.1-sources.jar" => "jung-3d-demos-2.0.1",
            "jung-algorithms-2.0.1-sources.jar" => "jung-algorithms-2.0.1",
            "jung-api-2.0.1-sources.jar" => "jung-api-2.0.1",
            "jung-graph-impl-2.0.1-sources.jar" => "jung-graph-impl-2.0.1",
            "jung-io-2.0.1-sources.jar" => "jung-io-2.0.1",
            "jung-jai-2.0.1-sources.jar" => "jung-jai-2.0.1",
            "jung-jai-samples-2.0.1-sources.jar" => "jung-jai-samples-2.0.1",
            "jung-samples-2.0.1-sources.jar" => "jung-samples-2.0.1",
            "jung-visualization-2.0.1-sources.jar" => "jung-visualization-2.0.1"
        );
        foreach my $file (keys %files) {
            print "\t\t unpacking $file\n";
            system("unzip -qo $corpusdir/src/$file -d $corpusdir/src/$files{$file}") == 0 or die "Failed to extract $file\n";
            system("rm $corpusdir/src/$file");
        }

	printf("\t\t unpacking $bin\n");
	system("unzip -qo $corpusdir/compressed/$bin @files -d $corpusdir/bin\n") == 0 or die "Failed to extract the bin $bin\n";
}

sub list_names {
	my ($appverdir) = @_;
	opendir(COMPRESSED, "$appverdir/compressed") || die "can't open $appverdir/compressed: $!";
	my @archives = grep {! /^\.$/ and ! /^\.\.$/ } readdir(COMPRESSED);
	close(COMPRESSED);
	return @archives;
}
