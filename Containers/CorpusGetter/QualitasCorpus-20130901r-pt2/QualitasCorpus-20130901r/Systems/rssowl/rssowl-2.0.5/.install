#!/usr/bin/perl -w

use strict;

if ($ARGV[0] eq "-list") {
	my @list = list_names($ARGV[1]);
	printf("@list");
} elsif ($ARGV[0] eq "-reduced") {
	my $destination = $ARGV[1];
	install_reduced($destination);
} else {
	my $destination = $ARGV[0];
	install_reduced($destination);
}

sub install_reduced {
	my ($corpusdir) = @_;
	my $src = "rssowl-2.0.5.source.zip";
	my $bin = "rssowl-2.0.5.linux.zip";
	my @files = ("rssowl/plugins/org.eclipse.core.contenttype_3.3.0.v20080604-1400.jar","rssowl/plugins/org.eclipse.core.net_1.1.0.I20080604.jar","rssowl/plugins/org.eclipse.core.databinding_1.1.1.M20080827-0800b.jar","rssowl/plugins/org.eclipse.equinox.registry_3.4.0.v20080516-0950.jar","rssowl/plugins/org.eclipse.osgi_3.4.3.R34x_v20081215-1030.jar","rssowl/plugins/org.eclipse.equinox.app_1.1.0.v20080421-2006.jar","rssowl/plugins/org.eclipse.update.ui_3.2.101.R34x_v20081128.jar","rssowl/plugins/org.eclipse.rcp_3.4.1.R342_v20090205.jar","rssowl/plugins/org.eclipse.ui_3.4.2.M20090204-0800.jar","rssowl/plugins/org.rssowl.lib.httpclient_2.0.5.201006012245.jar","rssowl/plugins/org.eclipse.update.configurator_3.2.201.R34x_v20080819.jar","rssowl/plugins/org.eclipse.core.commands_3.4.0.I20080509-2000.jar","rssowl/plugins/org.rssowl.core_2.0.5.201006012245.jar","rssowl/plugins/org.eclipse.equinox.simpleconfigurator_1.0.0.v20080604.jar","rssowl/plugins/org.rssowl.lib.jdom_2.0.5.201006012245.jar","rssowl/plugins/org.eclipse.core.jobs_3.4.1.R34x_v20081128.jar","rssowl/plugins/org.eclipse.core.expressions_3.4.1.r342_v20081203-0800.jar","rssowl/plugins/org.eclipse.swt_3.5.2.v3557f.jar","rssowl/plugins/org.eclipse.core.runtime_3.4.0.v20080512.jar","rssowl/plugins/org.rssowl.lib.db4o_2.0.5.201006012245.jar","rssowl/plugins/org.eclipse.ui.forms_3.3.103.v20081027_34x.jar","rssowl/plugins/org.eclipse.core.databinding.beans_1.1.1.M20080827-0800a.jar","rssowl/plugins/org.eclipse.update.core.linux_3.2.1.R34x_v20081024.jar","rssowl/plugins/org.eclipse.equinox.security_1.0.1.R34x_v20080721.jar","rssowl/plugins/org.eclipse.core.net.linux.x86_1.0.0.I20080521.jar","rssowl/plugins/org.eclipse.equinox.preferences_3.2.201.R34x_v20080709.jar","rssowl/plugins/org.eclipse.equinox.common_3.4.0.v20080421-2006.jar","rssowl/plugins/com.ibm.icu.base_3.8.1.v20080530.jar","rssowl/plugins/org.rssowl.ui_2.0.5.201006012245.jar","rssowl/plugins/org.eclipse.update.core_3.2.202.R34x_v20081128.jar","rssowl/plugins/org.eclipse.core.runtime.compatibility.auth_3.2.100.v20070502.jar","rssowl/plugins/org.eclipse.help_3.3.102.v20081014_34x.jar","rssowl/plugins/org.eclipse.equinox.launcher_1.0.101.R34x_v20081125.jar","rssowl/plugins/org.eclipse.ui.workbench_3.4.2.M20090127-1700.jar","rssowl/plugins/org.eclipse.jface_3.4.2.M20090107-0800.jar","rssowl/plugins/org.eclipse.jface.databinding_1.2.1.M20080827-0800a.jar","rssowl/plugins/org.eclipse.ui.net_1.0.0.I20080605.jar","rssowl/plugins/org.eclipse.swt.gtk.linux.x86_3.5.2.v3557f.jar","rssowl/plugins/org.rssowl.lib.lucene_2.0.5.201006012245.jar");
	printf("\t\t unpacking $src\n");
	system("unzip -qo $corpusdir/compressed/$src -d $corpusdir/src\n") == 0 or die "Failed to extract $src\n";
	printf("\t\t unpacking $bin\n");
	system("unzip -qo $corpusdir/compressed/$bin @files -d $corpusdir/bin\n") == 0 or die "Failed to extract $bin\n";
}

sub list_names {
	my ($appverdir) = @_;
	opendir(COMPRESSED, "$appverdir/compressed") || die "can't open $appverdir/compressed: $!";
	my @archives = grep {! /^\.$/ and ! /^\.\.$/ } readdir(COMPRESSED);
	close(COMPRESSED);
	return @archives;
}
