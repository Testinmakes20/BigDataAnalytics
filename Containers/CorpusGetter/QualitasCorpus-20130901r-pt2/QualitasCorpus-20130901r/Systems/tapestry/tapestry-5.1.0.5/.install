#!/usr/bin/perl -w

use strict;

if ($ARGV[0] eq "-list") {
	my @list = list_names($ARGV[1]);
	printf("@list");
} elsif ($ARGV[0] eq "-reduced") {
	my $destination = $ARGV[1];
	install_reduced($destination);
} else {
	my $destination = $ARGV[0];
	install_reduced($destination);
}

sub install_reduced {
	my ($corpusdir) = @_;
	my $src = "tapestry-src-5.1.0.5.tar.gz";
	my $bin = "tapestry-bin-5.1.0.5.tar.gz";
	my @files = ("lib/selenium-core-1.0-beta-2.jar","lib/gmaven-runtime-support-1.0-rc-3.jar","lib/gmaven-runtime-1.5-1.0-rc-3.jar","lib/spring-core-2.5.6.jar","lib/tapestry-hibernate-core-5.1.0.5.jar","lib/gmaven-feature-api-1.0-rc-3.jar","lib/hibernate-c3p0-3.3.1.GA.jar","lib/commons-codec-1.3.jar","lib/selenium-server-coreless-1.0-beta-2.jar","lib/ant-launcher-1.7.1.jar","lib/gmaven-runtime-api-1.0-rc-3.jar","lib/spring-context-2.5.6.jar","lib/junit-3.8.1.jar","lib/tapestry5-annotations-5.1.0.5.jar","lib/stax2-api-3.0.1.jar","lib/tapestry-core-5.1.0.5.jar","lib/tapestry-hibernate-5.1.0.5.jar","lib/slf4j-log4j12-1.5.2.jar","lib/gmaven-common-1.0-rc-3.jar","lib/jline-0.9.94.jar","lib/spring-beans-2.5.6.jar","lib/bcprov-jdk15-135.jar","lib/org.mortbay.jetty-5.1.10.jar","lib/tapestry-test-5.1.0.5.jar","lib/gmaven-runtime-default-1.0-rc-3.jar","lib/tapestry-ioc-5.1.0.5.jar","lib/plexus-utils-1.5.5.jar","lib/commons-fileupload-1.2.jar","lib/slf4j-api-1.5.2.jar","lib/commons-logging-1.1.1.jar","lib/servlet-api-2.4.jar","lib/stax-api-1.0.1.jar","lib/commons-io-1.3.jar","lib/selenium-java-client-driver-1.0-beta-2.jar","lib/javassist-3.9.0.GA.jar","lib/groovy-all-minimal-1.5.6.jar","lib/selenium-server-1.0-beta-2-standalone.jar","lib/spring-web-2.5.6.jar","lib/aopalliance-1.0.jar","lib/antlr-runtime-3.1.1.jar","lib/ant-1.6.5.jar","lib/qdox-1.6.3.jar","lib/selenium-server-1.0-beta-2.jar","lib/ant-1.7.1.jar","lib/tapestry-upload-5.1.0.5.jar","lib/woodstox-core-asl-4.0.3.jar","lib/tapestry-spring-5.1.0.5.jar","lib/gmaven-feature-support-1.0-rc-3.jar","lib/log4j-1.2.14.jar");
	printf("\t\t unpacking $src\n");
	system("tar zxf $corpusdir/compressed/$src -C $corpusdir/src\n") == 0 or die "Failed to extract $src\n";
	printf("\t\t unpacking $bin\n");
	system("tar zxf $corpusdir/compressed/$bin -C $corpusdir/bin @files\n") == 0 or die "Failed to extract $bin\n";
}

sub list_names {
	my ($appverdir) = @_;
	opendir(COMPRESSED, "$appverdir/compressed") || die "can't open $appverdir/compressed: $!";
	my @archives = grep {! /^\.$/ and ! /^\.\.$/ } readdir(COMPRESSED);
	close(COMPRESSED);
	return @archives;
}
