#!/usr/bin/perl -w

use strict;

if ($ARGV[0] eq "-list") {
	my @list = list_names($ARGV[1]);
	printf("@list");
} elsif ($ARGV[0] eq "-reduced") {
	my $destination = $ARGV[1];
	install_reduced($destination);
} else {
	my $destination = $ARGV[0];
	install_reduced($destination);
}

sub install_reduced {
	my ($corpusdir) = @_;
	my $src = "src.jar";
	my $bin = "squirrel-sql-3.1.2-standard.tar.gz";
	my @files = ("squirrel-sql-3.1.2/plugins/laf/lafs/napkinlaf.jar","squirrel-sql-3.1.2/lib/org-netbeans-modules-editor-util.jar","squirrel-sql-3.1.2/plugins/sqlscript.jar","squirrel-sql-3.1.2/plugins/laf/lafs/toniclf.jar","squirrel-sql-3.1.2/lib/openide-loaders.jar","squirrel-sql-3.1.2/lib/rsyntaxtextarea.jar","squirrel-sql-3.1.2/lib/commons-collections.jar","squirrel-sql-3.1.2/lib/asm-attrs.jar","squirrel-sql-3.1.2/lib/fw.jar","squirrel-sql-3.1.2/lib/autocomplete.jar","squirrel-sql-3.1.2/lib/spring-context.jar","squirrel-sql-3.1.2/lib/syntax.jar","squirrel-sql-3.1.2/lib/hibernate.jar","squirrel-sql-3.1.2/lib/antlr.jar","squirrel-sql-3.1.2/plugins/laf/lafs/kunststoff.jar","squirrel-sql-3.1.2/lib/hibernate-entitymanager.jar","squirrel-sql-3.1.2/lib/commons-logging.jar","squirrel-sql-3.1.2/lib/dom4j.jar","squirrel-sql-3.1.2/lib/log4j.jar","squirrel-sql-3.1.2/plugins/laf/lafs/substance.jar","squirrel-sql-3.1.2/lib/spring-beans.jar","squirrel-sql-3.1.2/lib/org-netbeans-modules-editor.jar","squirrel-sql-3.1.2/plugins/laf.jar","squirrel-sql-3.1.2/lib/hibernate-commons-annotations.jar","squirrel-sql-3.1.2/lib/hibernate-annotations.jar","squirrel-sql-3.1.2/Uninstaller/uninstaller.jar","squirrel-sql-3.1.2/lib/commons-codec.jar","squirrel-sql-3.1.2/lib/ejb3-persistence.jar","squirrel-sql-3.1.2/lib/asm.jar","squirrel-sql-3.1.2/plugins/codecompletion.jar","squirrel-sql-3.1.2/lib/org-netbeans-modules-editor-lib.jar","squirrel-sql-3.1.2/lib/spring-context-support.jar","squirrel-sql-3.1.2/lib/spring-core.jar","squirrel-sql-3.1.2/lib/commons-cli.jar","squirrel-sql-3.1.2/lib/org-netbeans-modules-editor-fold.jar","squirrel-sql-3.1.2/plugins/sqlbookmark.jar","squirrel-sql-3.1.2/lib/fife.common.jar","squirrel-sql-3.1.2/lib/stringtemplate.jar","squirrel-sql-3.1.2/plugins/laf/lafs/ilf-gpl.jar","squirrel-sql-3.1.2/plugins/laf/lafs/tinylaf.jar","squirrel-sql-3.1.2/lib/commons-httpclient.jar","squirrel-sql-3.1.2/plugins/laf/lafs/nimrodlf.jar","squirrel-sql-3.1.2/lib/nanoxml.jar","squirrel-sql-3.1.2/squirrel-sql.jar","squirrel-sql-3.1.2/lib/jxl.jar","squirrel-sql-3.1.2/lib/cglib.jar","squirrel-sql-3.1.2/plugins/laf/lafs/skinlf.jar","squirrel-sql-3.1.2/plugins/graph.jar","squirrel-sql-3.1.2/plugins/editextras.jar","squirrel-sql-3.1.2/plugins/laf/lafs/looks.jar","squirrel-sql-3.1.2/lib/forms.jar","squirrel-sql-3.1.2/plugins/laf/lafs/swingsetthemes.jar","squirrel-sql-3.1.2/lib/RText.jar","squirrel-sql-3.1.2/lib/openide.jar","squirrel-sql-3.1.2/lib/versioncheck.jar");
	printf("\t\t unpacking $src\n");
	system("unzip -qo $corpusdir/compressed/$src -d $corpusdir/src\n") == 0 or die "Failed to extract $src\n";
	printf("\t\t unpacking $bin\n");
	system("tar zxf $corpusdir/compressed/$bin -C $corpusdir/bin @files\n") == 0 or die "Failed to extract $bin\n";
}

sub list_names {
	my ($appverdir) = @_;
	opendir(COMPRESSED, "$appverdir/compressed") || die "can't open $appverdir/compressed: $!";
	my @archives = grep {! /^\.$/ and ! /^\.\.$/ } readdir(COMPRESSED);
	close(COMPRESSED);
	return @archives;
}
