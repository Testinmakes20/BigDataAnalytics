#!/usr/bin/perl -w

use strict;

if ($ARGV[0] eq "-list") {
	my @list = list_names($ARGV[1]);
	printf("@list");
} elsif ($ARGV[0] eq "-reduced") {
	my $destination = $ARGV[1];
	install_reduced($destination);
} else {
	my $destination = $ARGV[0];
	install_reduced($destination);
}

sub install_reduced {
	my ($corpusdir) = @_;
	my $src = "myfaces-core-2.0.2-src.zip";
	printf("\t\t unpacking $src\n");
	system("unzip -qo $corpusdir/compressed/$src -d $corpusdir/src\n") == 0 or die "Failed to extract $src\n";
	my @src_archives = (
	  "myfaces-core-2.0.2-src/src/myfaces-api-2.0.2-sources.jar",
	  "myfaces-core-2.0.2-src/src/myfaces-impl-2.0.2-sources.jar",
	  );
	foreach my $src_ar (@src_archives) {
	  system("unzip -qo $corpusdir/src/$src_ar -d $corpusdir/src/myfaces-core-2.0.2-src/src\n") == 0 or die "Failed to extract $src_ar\n";
	}

	my $bin = "myfaces-core-2.0.2-bin.zip";
	my @files = ("myfaces-core-2.0.2-bin/lib/commons-collections-3.2.jar","myfaces-core-2.0.2-bin/lib/commons-logging-1.1.1.jar","myfaces-core-2.0.2-bin/tlddoc/myfaces-impl-2.0.2-facelets-tlddoc.jar","myfaces-core-2.0.2-bin/lib/commons-discovery-0.4.jar","myfaces-core-2.0.2-bin/javadoc/myfaces-api-2.0.2-javadoc.jar","myfaces-core-2.0.2-bin/tlddoc/myfaces-impl-2.0.2-tlddoc.jar","myfaces-core-2.0.2-bin/lib/commons-codec-1.3.jar","myfaces-core-2.0.2-bin/lib/myfaces-impl-2.0.2.jar","myfaces-core-2.0.2-bin/lib/commons-digester-1.8.jar","myfaces-core-2.0.2-bin/javadoc/myfaces-impl-2.0.2-javadoc.jar","myfaces-core-2.0.2-bin/lib/myfaces-api-2.0.2.jar","myfaces-core-2.0.2-bin/lib/commons-beanutils-1.8.3.jar");
	printf("\t\t unpacking $bin\n");
	system("unzip -qo $corpusdir/compressed/$bin @files -d $corpusdir/bin\n") == 0 or die "Failed to extract $bin\n";
}

sub list_names {
	my ($appverdir) = @_;
	opendir(COMPRESSED, "$appverdir/compressed") || die "can't open $appverdir/compressed: $!";
	my @archives = grep {! /^\.$/ and ! /^\.\.$/ } readdir(COMPRESSED);
	close(COMPRESSED);
	return @archives;
}
