#!/usr/bin/perl -w

use strict;

if ($ARGV[0] eq "-list") {
	my @list = list_names($ARGV[1]);
	printf("@list");
} elsif ($ARGV[0] eq "-reduced") {
	my $destination = $ARGV[1];
	install_reduced($destination);
} else {
	my $destination = $ARGV[0];
	install_reduced($destination);
}

sub install_reduced {
	my ($corpusdir) = @_;
	my $src = "openjms-0.7.7-beta-1-src.zip";
	my $bin = "openjms-0.7.7-beta-1.tar.gz";
	my @files = ("openjms-0.7.7-beta-1/lib/jdbc-2.0.jar","openjms-0.7.7-beta-1/lib/antlr-2.7.2.jar","openjms-0.7.7-beta-1/lib/commons-dbcp-1.2.1.jar","openjms-0.7.7-beta-1/lib/commons-collections-2.1.jar","openjms-0.7.7-beta-1/lib/log4j-1.2.11.jar","openjms-0.7.7-beta-1/lib/commons-codec-1.3.jar","openjms-0.7.7-beta-1/lib/openjms-net-0.7.7-beta-1.jar","openjms-0.7.7-beta-1/lib/concurrent-1.3.4.jar","openjms-0.7.7-beta-1/lib/castor-0.9.5.jar","openjms-0.7.7-beta-1/lib/derby-10.1.1.0.jar","openjms-0.7.7-beta-1/lib/spice-jndikit-1.2.jar","openjms-0.7.7-beta-1/lib/jndi-1.2.1.jar","openjms-0.7.7-beta-1/lib/xml-apis-1.0.b2.jar","openjms-0.7.7-beta-1/lib/jms-1.1.jar","openjms-0.7.7-beta-1/lib/jta-1.0.1.jar","openjms-0.7.7-beta-1/lib/openjms-common-0.7.7-beta-1.jar","openjms-0.7.7-beta-1/lib/openjms-0.7.7-beta-1.jar","openjms-0.7.7-beta-1/lib/openjms-tools-0.7.7-beta-1.jar","openjms-0.7.7-beta-1/lib/commons-logging-1.0.4.jar","openjms-0.7.7-beta-1/lib/oro-2.0.8.jar","openjms-0.7.7-beta-1/lib/commons-pool-1.2.jar","openjms-0.7.7-beta-1/lib/xerces-2.4.0.jar");
	printf("\t\t unpacking $src\n");
	system("unzip -qo $corpusdir/compressed/$src -d $corpusdir/src\n") == 0 or die "Failed to extract $src\n";
	printf("\t\t unpacking $bin\n");
	system("tar zxf $corpusdir/compressed/$bin -C $corpusdir/bin @files\n") == 0 or die "Failed to extract $bin\n";
}

sub list_names {
	my ($appverdir) = @_;
	opendir(COMPRESSED, "$appverdir/compressed") || die "can't open $appverdir/compressed: $!";
	my @archives = grep {! /^\.$/ and ! /^\.\.$/ } readdir(COMPRESSED);
	close(COMPRESSED);
	return @archives;
}
