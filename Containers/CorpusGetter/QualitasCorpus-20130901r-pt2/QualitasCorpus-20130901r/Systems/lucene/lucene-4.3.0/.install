#!/usr/bin/perl -w

use strict;

if ($ARGV[0] eq "-list") {
	my @list = list_names($ARGV[1]);
	printf("@list");
} elsif ($ARGV[0] eq "-reduced") {
	my $destination = $ARGV[1];
	install_reduced($destination);
} else {
	my $destination = $ARGV[0];
	install_reduced($destination);
}

sub install_reduced {
	my ($corpusdir) = @_;
	my $src = "lucene-4.3.0-src.tgz";
	my $bin = "lucene-4.3.0.tgz";
	my @files = ("lucene-4.3.0/memory/lucene-memory-4.3.0.jar","lucene-4.3.0/spatial/lucene-spatial-4.3.0.jar","lucene-4.3.0/test-framework/lib/junit4-ant-2.0.9.jar","lucene-4.3.0/sandbox/lib/jakarta-regexp-1.4.jar","lucene-4.3.0/spatial/lib/spatial4j-0.3.jar","lucene-4.3.0/analysis/uima/lib/Tagger-2.3.1.jar","lucene-4.3.0/analysis/uima/lucene-analyzers-uima-4.3.0.jar","lucene-4.3.0/analysis/phonetic/lucene-analyzers-phonetic-4.3.0.jar","lucene-4.3.0/benchmark/lib/xercesImpl-2.9.1.jar","lucene-4.3.0/grouping/lucene-grouping-4.3.0.jar","lucene-4.3.0/analysis/phonetic/lib/commons-codec-1.7.jar","lucene-4.3.0/analysis/morfologik/lib/morfologik-stemming-1.5.5.jar","lucene-4.3.0/highlighter/lucene-highlighter-4.3.0.jar","lucene-4.3.0/analysis/kuromoji/lucene-analyzers-kuromoji-4.3.0.jar","lucene-4.3.0/analysis/common/lucene-analyzers-common-4.3.0.jar","lucene-4.3.0/analysis/morfologik/lib/morfologik-polish-1.5.5.jar","lucene-4.3.0/test-framework/lucene-test-framework-4.3.0.jar","lucene-4.3.0/analysis/stempel/lucene-analyzers-stempel-4.3.0.jar","lucene-4.3.0/test-framework/lib/junit-4.10.jar","lucene-4.3.0/analysis/uima/lib/uimaj-core-2.3.1.jar","lucene-4.3.0/queryparser/lucene-queryparser-4.3.0.jar","lucene-4.3.0/benchmark/lib/nekohtml-1.9.17.jar","lucene-4.3.0/facet/lucene-facet-4.3.0.jar","lucene-4.3.0/queries/lucene-queries-4.3.0.jar","lucene-4.3.0/core/lucene-core-4.3.0.jar","lucene-4.3.0/analysis/smartcn/lucene-analyzers-smartcn-4.3.0.jar","lucene-4.3.0/sandbox/lucene-sandbox-4.3.0.jar","lucene-4.3.0/join/lucene-join-4.3.0.jar","lucene-4.3.0/analysis/uima/lib/WhitespaceTokenizer-2.3.1.jar","lucene-4.3.0/demo/lucene-demo-4.3.0.jar","lucene-4.3.0/benchmark/lib/commons-compress-1.4.1.jar","lucene-4.3.0/analysis/morfologik/lucene-analyzers-morfologik-4.3.0.jar","lucene-4.3.0/analysis/icu/lucene-analyzers-icu-4.3.0.jar","lucene-4.3.0/codecs/lucene-codecs-4.3.0.jar","lucene-4.3.0/misc/lucene-misc-4.3.0.jar","lucene-4.3.0/analysis/morfologik/lib/morfologik-fsa-1.5.5.jar","lucene-4.3.0/analysis/icu/lib/icu4j-49.1.jar","lucene-4.3.0/test-framework/lib/randomizedtesting-runner-2.0.9.jar","lucene-4.3.0/benchmark/lucene-benchmark-4.3.0.jar","lucene-4.3.0/test-framework/lib/ant-1.8.2.jar","lucene-4.3.0/classification/lucene-classification-4.3.0.jar","lucene-4.3.0/suggest/lucene-suggest-4.3.0.jar");
	printf("\t\t unpacking $src\n");
	system("tar zxf $corpusdir/compressed/$src -C $corpusdir/src\n") == 0 or die "Failed to extract $src\n";
	printf("\t\t unpacking $bin\n");
	system("tar zxf $corpusdir/compressed/$bin -C $corpusdir/bin @files\n") == 0 or die "Failed to extract $bin\n";
}

sub list_names {
	my ($appverdir) = @_;
	opendir(COMPRESSED, "$appverdir/compressed") || die "can't open $appverdir/compressed: $!";
	my @archives = grep {! /^\.$/ and ! /^\.\.$/ } readdir(COMPRESSED);
	close(COMPRESSED);
	return @archives;
}
