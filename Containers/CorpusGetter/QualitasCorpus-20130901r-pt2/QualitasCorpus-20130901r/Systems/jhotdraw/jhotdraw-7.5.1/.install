#!/usr/bin/perl -w
# Modified from generated version by Ewan

use strict;

if ($ARGV[0] eq "-list") {
	my @list = list_names($ARGV[1]);
	printf("@list");
} elsif ($ARGV[0] eq "-reduced") {
	my $destination = $ARGV[1];
	install_reduced($destination);
} else {
	my $destination = $ARGV[0];
	install_reduced($destination);
}

sub install_reduced {
	my ($corpusdir) = @_;
	my $src1 = "jhotdraw-7.5.1.nested.zip";
	my $src2 = "JHotDraw\\ 7.5.1.zip";
	printf("\t\t unpacking $src1\n");
	system("unzip -qo $corpusdir/compressed/$src1 -d $corpusdir/src\n") == 0 or die "Failed to extract $src1\n";
	printf("\t\t unpacking $src2\n");
	system("unzip -q $corpusdir/src/$src2 -d $corpusdir/src\n") == 0 or die "Failed to extract $src2\n";
	system("/bin/rm $corpusdir/src/$src2");
	printf("\t\t Populating bin\n");
	my $file = "JHotDraw\\ 7.5.1/Samples/JHotDraw/jhotdraw.jar";
	system("mv $corpusdir/src/$file $corpusdir/bin\n") == 0 or die "Failed to extract $file\n";
}

sub list_names {
	my ($appverdir) = @_;
	opendir(COMPRESSED, "$appverdir/compressed") || die "can't open $appverdir/compressed: $!";
	my @archives = grep {! /^\.$/ and ! /^\.\.$/ } readdir(COMPRESSED);
	close(COMPRESSED);
	return @archives;
}
