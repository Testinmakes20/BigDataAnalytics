#!/usr/bin/perl -w

use strict;

if ($ARGV[0] eq "-list") {
	my @list = list_names($ARGV[1]);
	printf("@list");
} elsif ($ARGV[0] eq "-reduced") {
	my $destination = $ARGV[1];
	install_reduced($destination);
} else {
	my $destination = $ARGV[0];
	install_reduced($destination);
}

sub install_reduced {
	my ($corpusdir) = @_;
	my $src = "batik-src-1.7.zip";
	my $bin = "batik-1.7.zip";
	my @files = ("batik-1.7/lib/batik-svg-dom.jar","batik-1.7/lib/batik-bridge.jar","batik-1.7/lib/batik-ext.jar","batik-1.7/docs/demo/batik-swing.jar","batik-1.7/batik-rasterizer.jar","batik-1.7/docs/demo/batik-ext.jar","batik-1.7/lib/xerces_2_5_0.jar","batik-1.7/lib/batik-extension.jar","batik-1.7/lib/batik-dom.jar","batik-1.7/lib/xml-apis-ext.jar","batik-1.7/docs/demo/batik-parser.jar","batik-1.7/docs/demo/batik-dom.jar","batik-1.7/extensions/batik-squiggle-ext.jar","batik-1.7/docs/demo/batik-script.jar","batik-1.7/docs/demo/batik-gvt.jar","batik-1.7/docs/demo/batik-xml.jar","batik-1.7/lib/batik-script.jar","batik-1.7/batik-slideshow.jar","batik-1.7/lib/batik-css.jar","batik-1.7/docs/demo/xml-apis-dom3.jar","batik-1.7/batik-svgpp.jar","batik-1.7/extensions/batik-rasterizer-ext.jar","batik-1.7/lib/xalan-2.6.0.jar","batik-1.7/batik.jar","batik-1.7/lib/batik-awt-util.jar","batik-1.7/lib/xml-apis.jar","batik-1.7/lib/batik-transcoder.jar","batik-1.7/docs/demo/batik-css.jar","batik-1.7/lib/js.jar","batik-1.7/lib/pdf-transcoder.jar","batik-1.7/batik-squiggle.jar","batik-1.7/docs/demo/batik-awt-util.jar","batik-1.7/batik-ttf2svg.jar","batik-1.7/lib/batik-xml.jar","batik-1.7/lib/batik-swing.jar","batik-1.7/docs/demo/batik-svg-dom.jar","batik-1.7/docs/demo/batik-util.jar","batik-1.7/lib/batik-anim.jar","batik-1.7/docs/demo/batik-bridge.jar","batik-1.7/lib/batik-parser.jar","batik-1.7/lib/batik-gui-util.jar","batik-1.7/lib/batik-util.jar","batik-1.7/lib/batik-codec.jar","batik-1.7/lib/batik-gvt.jar","batik-1.7/lib/batik-svggen.jar");
	printf("\t\t unpacking $src\n");
	system("unzip -qo $corpusdir/compressed/$src -d $corpusdir/src\n") == 0 or die "Failed to extract $src\n";
	printf("\t\t unpacking $bin\n");
	system("unzip -qo $corpusdir/compressed/$bin @files -d $corpusdir/bin\n") == 0 or die "Failed to extract $bin\n";
}

sub list_names {
	my ($appverdir) = @_;
	opendir(COMPRESSED, "$appverdir/compressed") || die "can't open $appverdir/compressed: $!";
	my @archives = grep {! /^\.$/ and ! /^\.\.$/ } readdir(COMPRESSED);
	close(COMPRESSED);
	return @archives;
}
