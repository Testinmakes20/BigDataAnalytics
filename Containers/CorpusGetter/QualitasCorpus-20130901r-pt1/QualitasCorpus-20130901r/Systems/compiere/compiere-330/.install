#!/usr/bin/perl -w

use strict;

if ($ARGV[0] eq "-list") {
	my @list = list_names($ARGV[1]);
	printf("@list");
} elsif ($ARGV[0] eq "-reduced") {
	my $destination = $ARGV[1];
	install_reduced($destination);
} else {
	my $destination = $ARGV[0];
	install_reduced($destination);
}

sub install_reduced {
	my ($corpusdir) = @_;
	my $src = "Compiere_330_Source.zip";
	my $bin = "Compiere_330.zip";
	my @files = ("Compiere2/jboss/server/compiere/lib/jbossts-common.jar","Compiere2/jboss/server/compiere/deploy/management/console-mgr.sar/console-mgr-classes.jar","Compiere2/jboss/server/compiere/lib/mail-plugin.jar","Compiere2/jboss/server/compiere/deploy/jboss-web.deployer/jstl.jar","Compiere2/jboss/bin/shutdown.jar","Compiere2/jboss/lib/jboss-jmx.jar","Compiere2/jboss/server/compiere/deploy/jboss-web.deployer/jbossweb.jar","Compiere2/lib/jboss.jar","Compiere2/jboss/server/compiere/lib/jbossjta-integration.jar","Compiere2/jboss/lib/concurrent.jar","Compiere2/jboss/server/compiere/lib/jboss-transaction.jar","Compiere2/jboss/server/compiere/lib/jnpserver.jar","Compiere2/jboss/server/compiere/lib/jboss-serialization.jar","Compiere2/jboss/lib/jboss-system.jar","Compiere2/jboss/server/compiere/deploy/jboss-bean.deployer/jboss-microcontainer.jar","Compiere2/jboss/server/compiere/lib/commons-collections.jar","Compiere2/jboss/server/compiere/lib/jbossjta.jar","Compiere2/jboss/server/compiere/lib/autonumber-plugin.jar","Compiere2/jboss/server/compiere/lib/ejb3-persistence.jar","Compiere2/lib/compiereRoot.jar","Compiere2/lib/jPDF.jar","Compiere2/lib/sqljDB2.jar","Compiere2/jboss/server/compiere/lib/jboss-jsr77.jar","Compiere2/jboss/lib/endorsed/serializer.jar","Compiere2/jboss/lib/jboss-common.jar","Compiere2/lib/compiereApps.jar","Compiere2/jboss/server/compiere/deploy/jboss-web.deployer/jsf-libs/jboss-faces.jar","Compiere2/jboss/server/compiere/lib/bsh.jar","Compiere2/jboss/server/compiere/lib/jboss-ejb3x.jar","Compiere2/jboss/server/compiere/lib/quartz.jar","Compiere2/lib/db2.jar","Compiere2/jboss/server/compiere/lib/jbossws-common.jar","Compiere2/lib/postgreSQL.jar","Compiere2/lib/CompiereInstall.jar","Compiere2/jboss/server/compiere/lib/servlet-api.jar","Compiere2/lib/oracle.jar","Compiere2/jboss/server/compiere/lib/jboss-remoting.jar","Compiere2/jboss/server/compiere/deploy/management/console-mgr.sar/web-console.war/applet.jar","Compiere2/jboss/server/compiere/lib/joesnmp.jar","Compiere2/jboss/lib/commons-codec.jar","Compiere2/jboss/lib/endorsed/jboss-jaxws.jar","Compiere2/jboss/server/compiere/lib/jboss-iiop.jar","Compiere2/jboss/lib/jaxb-impl.jar","Compiere2/jboss/server/compiere/lib/jboss-vfs.jar","Compiere2/lib/sqlServer.jar","Compiere2/jboss/server/compiere/lib/log4j-snmp-appender.jar","Compiere2/jboss/server/compiere/lib/bsf.jar","Compiere2/lib/sqlj.jar","Compiere2/jboss/lib/endorsed/jboss-saaj.jar","Compiere2/jboss/server/compiere/lib/bsh-deployer.jar","Compiere2/jboss/server/compiere/deploy/ejb3.deployer/jboss-ejb3.jar","Compiere2/jboss/server/compiere/deploy/ejb3.deployer/jboss-annotations-ejb3.jar","Compiere2/jboss/server/compiere/lib/jbossmq.jar","Compiere2/lib/j2ee.jar","Compiere2/jboss/server/compiere/deploy/jboss-web.deployer/jbossweb-extras.jar","Compiere2/jboss/server/compiere/lib/jboss-hibernate.jar","Compiere2/jboss/server/compiere/lib/cglib.jar","Compiere2/jboss/server/compiere/lib/activation.jar","Compiere2/lib/CInstall.jar","Compiere2/jboss/server/compiere/lib/bindingservice-plugin.jar","Compiere2/jboss/server/compiere/lib/jsp-api.jar","Compiere2/jboss/server/compiere/deploy/jboss-web.deployer/jsf-libs/jsf-impl.jar","Compiere2/jboss/lib/commons-httpclient.jar","Compiere2/jboss/server/compiere/deploy/jboss-bean.deployer/jboss-dependency.jar","Compiere2/jboss/server/compiere/lib/el-api.jar","Compiere2/jboss/server/compiere/lib/jmx-adaptor-plugin.jar","Compiere2/jboss/server/compiere/lib/antlr.jar","Compiere2/jboss/lib/endorsed/xercesImpl.jar","Compiere2/jboss/server/compiere/lib/jbossws-framework.jar","Compiere2/jboss/server/compiere/lib/log4j.jar","Compiere2/jboss/server/compiere/lib/jbossws-jboss42.jar","Compiere2/jboss/server/compiere/lib/dom4j.jar","Compiere2/jboss/lib/endorsed/xalan.jar","Compiere2/lib/ibmWAS.jar","Compiere2/jboss/server/compiere/lib/jaxen.jar","Compiere2/jboss/server/compiere/deploy/jboss-web.deployer/jasper-jdt.jar","Compiere2/jboss/server/compiere/lib/jboss-jsr88.jar","Compiere2/jboss/server/compiere/deploy/jboss-web.deployer/jbossweb-service.jar","Compiere2/jboss/server/compiere/lib/jboss-management.jar","Compiere2/jboss/bin/run.jar","Compiere2/jboss/server/compiere/deploy/management/console-mgr.sar/jfreechart.jar","Compiere2/lib/CCTools.jar","Compiere2/jboss/server/compiere/lib/javassist.jar","Compiere2/jboss/server/compiere/deploy/management/console-mgr.sar/web-console.war/images/otherimages.jar","Compiere2/lib/Compiere.jar","Compiere2/jboss/server/compiere/lib/jboss-monitoring.jar","Compiere2/jboss/server/compiere/lib/properties-plugin.jar","Compiere2/jboss/server/compiere/lib/bcel.jar","Compiere2/jboss/server/compiere/lib/jboss-remoting-int.jar","Compiere2/jboss/server/compiere/deploy/jboss-web.deployer/jsf-libs/jsf-api.jar","Compiere2/jboss/lib/commons-logging.jar","Compiere2/jboss/server/compiere/lib/hibernate-annotations.jar","Compiere2/jboss/lib/getopt.jar","Compiere2/jboss/server/compiere/lib/xmlentitymgr.jar","Compiere2/jboss/server/compiere/lib/hibernate3.jar","Compiere2/jboss/lib/log4j-boot.jar","Compiere2/jboss/server/compiere/lib/scheduler-plugin.jar","Compiere2/jboss/server/compiere/lib/hibernate-entitymanager.jar","Compiere2/jboss/lib/endorsed/jboss-jaxrpc.jar","Compiere2/jboss/lib/jboss-xml-binding.jar","Compiere2/jboss/lib/endorsed/jaxb-api.jar","Compiere2/jboss/server/compiere/deploy/jboss-bean.deployer/jboss-container.jar","Compiere2/jboss/server/compiere/deploy/management/console-mgr.sar/jcommon.jar","Compiere2/jboss/server/compiere/lib/scheduler-plugin-example.jar","Compiere2/jboss/server/compiere/lib/jbosssx.jar","Compiere2/lib/CSTools.jar","Compiere2/jboss/bin/twiddle.jar","Compiere2/jboss/server/compiere/lib/jboss-jca.jar","Compiere2/jboss/server/compiere/lib/jbossws-spi.jar","Compiere2/jboss/server/compiere/lib/jboss-j2ee.jar","Compiere2/jboss/server/compiere/lib/mail.jar","Compiere2/jboss/server/compiere/lib/jboss-common-jdbc-wrapper.jar","Compiere2/jboss/lib/endorsed/jboss-jaxws-ext.jar","Compiere2/jboss/server/compiere/lib/jboss-srp.jar","Compiere2/jboss/server/compiere/deploy/jboss-bean.deployer/jboss-bean-deployer.jar");
	printf("\t\t unpacking $src\n");
	system("unzip -qo $corpusdir/compressed/$src -d $corpusdir/src\n") == 0 or die "Failed to extract $src\n";
	printf("\t\t unpacking $bin\n");
	system("unzip -qo $corpusdir/compressed/$bin @files -d $corpusdir/bin\n") == 0 or die "Failed to extract $bin\n";
}

sub list_names {
	my ($appverdir) = @_;
	opendir(COMPRESSED, "$appverdir/compressed") || die "can't open $appverdir/compressed: $!";
	my @archives = grep {! /^\.$/ and ! /^\.\.$/ } readdir(COMPRESSED);
	close(COMPRESSED);
	return @archives;
}
