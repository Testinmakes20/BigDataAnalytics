#!/usr/bin/perl -w

use strict;

if ($ARGV[0] eq "-list") {
	my @list = list_names($ARGV[1]);
	printf("@list");
} elsif ($ARGV[0] eq "-reduced") {
	my $destination = $ARGV[1];
	install_reduced($destination);
} else {
	my $destination = $ARGV[0];
	install_reduced($destination);
}

sub install_reduced {
	my ($corpusdir) = @_;
	my $src = "heritrix-1.14.4-src.tar.gz";
	my $bin = "heritrix-1.14.4.tar.gz";
	my @files = ("heritrix-1.14.4/lib/dnsjava-2.0.3.jar","heritrix-1.14.4/lib/javaswf-CVS-SNAPSHOT-1.jar","heritrix-1.14.4/lib/commons-net-2.0.jar","heritrix-1.14.4/lib/je-3.3.82.jar","heritrix-1.14.4/lib/commons-httpclient-3.1.jar","heritrix-1.14.4/lib/bsh-2.0b4.jar","heritrix-1.14.4/lib/commons-cli-1.0.jar","heritrix-1.14.4/lib/jasper-runtime-tomcat-4.1.30.jar","heritrix-1.14.4/lib/jets3t-0.5.0.jar","heritrix-1.14.4/lib/jetty-4.2.23.jar","heritrix-1.14.4/lib/commons-codec-1.3.jar","heritrix-1.14.4/lib/libidn-0.5.9.jar","heritrix-1.14.4/heritrix-1.14.4.jar","heritrix-1.14.4/bin/cmdline-jmxclient-0.10.5.jar","heritrix-1.14.4/lib/itext-1.2.0.jar","heritrix-1.14.4/lib/ant-1.6.2.jar","heritrix-1.14.4/lib/poi-scratchpad-2.0-RC1-20031102.jar","heritrix-1.14.4/lib/jericho-html-2.6.jar","heritrix-1.14.4/lib/fastutil-5.0.3-heritrix-subset-1.0.jar","heritrix-1.14.4/lib/mg4j-1.0.1.jar","heritrix-1.14.4/lib/commons-collections-3.1.jar","heritrix-1.14.4/lib/commons-io-1.3.1.jar","heritrix-1.14.4/lib/junit-3.8.2.jar","heritrix-1.14.4/lib/commons-lang-2.3.jar","heritrix-1.14.4/lib/poi-2.0-RC1-20031102.jar","heritrix-1.14.4/lib/commons-logging-1.0.4.jar","heritrix-1.14.4/lib/jasper-compiler-tomcat-4.1.30.jar","heritrix-1.14.4/lib/joda-time-1.6.jar","heritrix-1.14.4/lib/servlet-tomcat-4.1.30.jar","heritrix-1.14.4/lib/commons-pool-1.3.jar");
	printf("\t\t unpacking $src\n");
	system("tar zxf $corpusdir/compressed/$src -C $corpusdir/src\n") == 0 or die "Failed to extract $src\n";
	printf("\t\t unpacking $bin\n");
	system("tar zxf $corpusdir/compressed/$bin -C $corpusdir/bin @files\n") == 0 or die "Failed to extract $bin\n";
}

sub list_names {
	my ($appverdir) = @_;
	opendir(COMPRESSED, "$appverdir/compressed") || die "can't open $appverdir/compressed: $!";
	my @archives = grep {! /^\.$/ and ! /^\.\.$/ } readdir(COMPRESSED);
	close(COMPRESSED);
	return @archives;
}
