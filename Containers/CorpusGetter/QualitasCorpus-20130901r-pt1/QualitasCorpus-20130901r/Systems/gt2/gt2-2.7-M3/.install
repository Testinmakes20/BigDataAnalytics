#!/usr/bin/perl -w

use strict;

if ($ARGV[0] eq "-list") {
	my @list = list_names($ARGV[1]);
	printf("@list");
} elsif ($ARGV[0] eq "-reduced") {
	my $destination = $ARGV[1];
	install_reduced($destination);
} else {
	my $destination = $ARGV[0];
	install_reduced($destination);
}

sub install_reduced {
	my ($corpusdir) = @_;
	my $src = "geotools-2.7-M3-project.zip";
	my $bin = "geotools-2.7-M3-bin.zip";
	my @files = ("geotools-2.7-M3/gt-sample-data-2.7-M3.jar","geotools-2.7-M3/gt-geojson-2.7-M3.jar","geotools-2.7-M3/imageio-ext-imagereadmt-1.1M012010.jar","geotools-2.7-M3/jcommon-1.0.13.jar","geotools-2.7-M3/hatbox-1.0.b7.jar","geotools-2.7-M3/gt-jdbc-spatialite-2.7-M3.jar","geotools-2.7-M3/xml-apis-xerces-2.7.1.jar","geotools-2.7-M3/vecmath-1.3.2.jar","geotools-2.7-M3/gt-xsd-wps-2.7-M3.jar","geotools-2.7-M3/commons-collections-3.1.jar","geotools-2.7-M3/gt-db2-2.7-M3.jar","geotools-2.7-M3/imageio-ext-gdalarcbinarygrid-1.0.7.jar","geotools-2.7-M3/gt-geometry-2.7-M3.jar","geotools-2.7-M3/gt-jdbc-2.7-M3.jar","geotools-2.7-M3/batik-awt-util-1.7.jar","geotools-2.7-M3/gt-jdbc-sqlserver-2.7-M3.jar","geotools-2.7-M3/jts-1.11.jar","geotools-2.7-M3/gt-data-2.7-M3.jar","geotools-2.7-M3/gt-epsg-h2-2.7-M3.jar","geotools-2.7-M3/gt-xsd-filter-2.7-M3.jar","geotools-2.7-M3/jai_imageio-1.1.jar","geotools-2.7-M3/gt-epsg-wkt-2.7-M3.jar","geotools-2.7-M3/log4j-1.2.12.jar","geotools-2.7-M3/net.opengis.wcs-2.7-M3.jar","geotools-2.7-M3/xmlgraphics-commons-1.2.jar","geotools-2.7-M3/gt-referencing3D-2.7-M3.jar","geotools-2.7-M3/gt-imageio-ext-gdal-2.7-M3.jar","geotools-2.7-M3/postgis-driver-1.0.jar","geotools-2.7-M3/commons-httpclient-3.1.jar","geotools-2.7-M3/commons-cli-2.0-gt2-pre1.jar","geotools-2.7-M3/gt-referencing-2.7-M3.jar","geotools-2.7-M3/gt-oracle-spatial-2.7-M3.jar","geotools-2.7-M3/batik-transcoder-1.7.jar","geotools-2.7-M3/gt-arcsde-common-2.7-M3.jar","geotools-2.7-M3/commons-pool-1.5.4.jar","geotools-2.7-M3/imageio-ext-gdalmrsidjp2-1.0.7.jar","geotools-2.7-M3/json-simple-1.1.jar","geotools-2.7-M3/xercesImpl-2.7.1.jar","geotools-2.7-M3/gt-postgis-versioned-2.7-M3.jar","geotools-2.7-M3/jai_codec-1.1.3.jar","geotools-2.7-M3/bufr-1.1.00.jar","geotools-2.7-M3/avalon-framework-impl-4.3.1.jar","geotools-2.7-M3/gt-image-2.7-M3.jar","geotools-2.7-M3/imageio-ext-customstreams-1.0.7.jar","geotools-2.7-M3/h2-1.1.119.jar","geotools-2.7-M3/net.opengis.ows-2.7-M3.jar","geotools-2.7-M3/commons-beanutils-1.7.0.jar","geotools-2.7-M3/gt-coveragetools-2.7-M3.jar","geotools-2.7-M3/gt-gtopo30-2.7-M3.jar","geotools-2.7-M3/imageio-ext-gdalecwjp2-1.0.7.jar","geotools-2.7-M3/batik-css-1.7.jar","geotools-2.7-M3/hsqldb-1.8.0.7.jar","geotools-2.7-M3/batik-ext-1.7.jar","geotools-2.7-M3/gt-feature-pregeneralized-2.7-M3.jar","geotools-2.7-M3/gt-app-schema-resolver-2.7-M3.jar","geotools-2.7-M3/postgresql-8.4-701.jdbc3.jar","geotools-2.7-M3/imageio-ext-gdalenvihdr-1.0.7.jar","geotools-2.7-M3/gt-sample-data-access-2.7-M3.jar","geotools-2.7-M3/batik-util-1.7.jar","geotools-2.7-M3/imageio-ext-gdalframework-1.0.7.jar","geotools-2.7-M3/gt-render-2.7-M3.jar","geotools-2.7-M3/common-2.2.1.jar","geotools-2.7-M3/net.opengis.wps-2.7-M3.jar","geotools-2.7-M3/batik-anim-1.7.jar","geotools-2.7-M3/gt-shapefile-renderer-2.7-M3.jar","geotools-2.7-M3/imageio-ext-jmatio-1.1M012010.jar","geotools-2.7-M3/imageio-ext-tiff-1.0.7.jar","geotools-2.7-M3/batik-svggen-1.7.jar","geotools-2.7-M3/geodb-0.3.jar","geotools-2.7-M3/fop-0.94.jar","geotools-2.7-M3/gt-epsg-hsql-2.7-M3.jar","geotools-2.7-M3/gt-xsd-core-2.7-M3.jar","geotools-2.7-M3/gt-jdbc-mysql-2.7-M3.jar","geotools-2.7-M3/jsqlparser-0.3.14.jar","geotools-2.7-M3/batik-svg-dom-1.7.jar","geotools-2.7-M3/jsr-275-1.0-beta-2.jar","geotools-2.7-M3/eastwood-1.1.1-SNAPSHOT.jar","geotools-2.7-M3/org.w3.xlink-2.7-M3.jar","geotools-2.7-M3/gt-coverageio-netcdf-2.7-M3.jar","geotools-2.7-M3/gt-process-2.7-M3.jar","geotools-2.7-M3/gt-matfile5-2.7-M3.jar","geotools-2.7-M3/gt-api-2.7-M3.jar","geotools-2.7-M3/batik-bridge-1.7.jar","geotools-2.7-M3/icu4j-3.4.4.jar","geotools-2.7-M3/gt-wms-2.7-M3.jar","geotools-2.7-M3/batik-gvt-1.7.jar","geotools-2.7-M3/gt-vpf-2.7-M3.jar","geotools-2.7-M3/imageio-ext-mat-sas-1.1M012010.jar","geotools-2.7-M3/gt-charts-2.7-M3.jar","geotools-2.7-M3/batik-dom-1.7.jar","geotools-2.7-M3/gt-graph-2.7-M3.jar","geotools-2.7-M3/jdom-1.0.jar","geotools-2.7-M3/gt-wps-2.7-M3.jar","geotools-2.7-M3/gt-jdbc-db2-2.7-M3.jar","geotools-2.7-M3/imageio-ext-gdalehdr-1.0.7.jar","geotools-2.7-M3/gt-geotiff-2.7-M3.jar","geotools-2.7-M3/gt-xsd-gml3-2.7-M3.jar","geotools-2.7-M3/slf4j-api-1.4.0.jar","geotools-2.7-M3/grib-5.1.03.jar","geotools-2.7-M3/gt-metadata-2.7-M3.jar","geotools-2.7-M3/gt-arcgrid-2.7-M3.jar","geotools-2.7-M3/gt-postgis-2.7-M3.jar","geotools-2.7-M3/imageio-ext-utilities-1.0.7.jar","geotools-2.7-M3/gt-main-2.7-M3.jar","geotools-2.7-M3/gt-xml-2.7-M3.jar","geotools-2.7-M3/slf4j-jdk14-1.4.0.jar","geotools-2.7-M3/gt-mysql-2.7-M3.jar","geotools-2.7-M3/gt-imagepyramid-2.7-M3.jar","geotools-2.7-M3/avalon-framework-api-4.3.1.jar","geotools-2.7-M3/commons-codec-1.2.jar","geotools-2.7-M3/ecore-2.2.2.jar","geotools-2.7-M3/imageio-ext-gdal-bindings-1.4.5b.jar","geotools-2.7-M3/xpp3-1.1.3.4.O.jar","geotools-2.7-M3/gt-validation-2.7-M3.jar","geotools-2.7-M3/commons-digester-1.7.jar","geotools-2.7-M3/gt-imagemosaic-jdbc-2.7-M3.jar","geotools-2.7-M3/gt-epsg-oracle-2.7-M3.jar","geotools-2.7-M3/gt-brewer-2.7-M3.jar","geotools-2.7-M3/imageio-ext-gdalmrsid-1.0.7.jar","geotools-2.7-M3/imageio-ext-mat-core-1.1M012010.jar","geotools-2.7-M3/gt-jts-wrapper-2.7-M3.jar","geotools-2.7-M3/jfreechart-1.0.10.jar","geotools-2.7-M3/gt-jdbc-postgis-2.7-M3.jar","geotools-2.7-M3/xsd-2.2.2.jar","geotools-2.7-M3/gt-coverage-2.7-M3.jar","geotools-2.7-M3/xml-apis-ext-1.3.04.jar","geotools-2.7-M3/imageio-ext-imagereadmt-1.0.7.jar","geotools-2.7-M3/commons-io-1.2.jar","geotools-2.7-M3/gt-xsd-wcs-2.7-M3.jar","geotools-2.7-M3/miglayout-3.7-swing.jar","geotools-2.7-M3/imageio-ext-customstreams-1.1M012010.jar","geotools-2.7-M3/batik-xml-1.7.jar","geotools-2.7-M3/imageio-ext-gdalnitf-1.0.7.jar","geotools-2.7-M3/xml-apis-1.3.04.jar","geotools-2.7-M3/gt-grid-2.7-M3.jar","geotools-2.7-M3/gt-arcsde-2.7-M3.jar","geotools-2.7-M3/net.opengis.wfs-2.7-M3.jar","geotools-2.7-M3/gt-coverageio-2.7-M3.jar","geotools-2.7-M3/netcdf-2.2.20.jar","geotools-2.7-M3/gt-property-2.7-M3.jar","geotools-2.7-M3/commons-io-1.4.jar","geotools-2.7-M3/gt-xsd-sld-2.7-M3.jar","geotools-2.7-M3/geoapi-pending-2.3-M1.jar","geotools-2.7-M3/imageio-ext-kakadujni-5.2.6.jar","geotools-2.7-M3/imageio-ext-gdalecw-1.0.7.jar","geotools-2.7-M3/gt-jp2k-2.7-M3.jar","geotools-2.7-M3/gt-app-schema-2.7-M3.jar","geotools-2.7-M3/xml-commons-resolver-1.2.jar","geotools-2.7-M3/gt-jdbc-oracle-2.7-M3.jar","geotools-2.7-M3/sqlite-jdbc-3.6.19.1-SNAPSHOT.jar","geotools-2.7-M3/gt-wfs-2.7-M3.jar","geotools-2.7-M3/commons-lang-2.3.jar","geotools-2.7-M3/batik-script-1.7.jar","geotools-2.7-M3/xalan-2.6.0.jar","geotools-2.7-M3/gt-epsg-extension-2.7-M3.jar","geotools-2.7-M3/imageio-ext-gdaldted-1.0.7.jar","geotools-2.7-M3/imageio-ext-geocore-1.0.7.jar","geotools-2.7-M3/imageio-ext-kakadu-1.0.7.jar","geotools-2.7-M3/gt-epsg-postgresql-2.7-M3.jar","geotools-2.7-M3/commons-dbcp-1.3.jar","geotools-2.7-M3/gt-imagemosaic-2.7-M3.jar","geotools-2.7-M3/commons-logging-1.1.1.jar","geotools-2.7-M3/ant-optional-1.5.1.jar","geotools-2.7-M3/imageio-ext-gdalerdasimg-1.0.7.jar","geotools-2.7-M3/mysql-connector-java-5.1.5.jar","geotools-2.7-M3/gt-caching-2.7-M3.jar","geotools-2.7-M3/gt-xsd-gml2-2.7-M3.jar","geotools-2.7-M3/gt-xsd-ows-2.7-M3.jar","geotools-2.7-M3/imageio-ext-gdalkakadujp2-1.0.7.jar","geotools-2.7-M3/gt-shapefile-2.7-M3.jar","geotools-2.7-M3/gt-temporal-2.7-M3.jar","geotools-2.7-M3/gt-swing-2.7-M3.jar","geotools-2.7-M3/geoapi-2.3-M1.jar","geotools-2.7-M3/gt-cql-2.7-M3.jar","geotools-2.7-M3/gt-svg-2.7-M3.jar","geotools-2.7-M3/picocontainer-1.2.jar","geotools-2.7-M3/gt-xsd-wfs-2.7-M3.jar","geotools-2.7-M3/imageio-ext-arcgrid-1.0.7.jar","geotools-2.7-M3/commons-jxpath-1.2.jar","geotools-2.7-M3/gt-jdbc-h2-2.7-M3.jar","geotools-2.7-M3/gnu-regexp-1.1.4.jar","geotools-2.7-M3/net.opengis.wfsv-2.7-M3.jar","geotools-2.7-M3/gt-xsd-kml-2.7-M3.jar","geotools-2.7-M3/batik-parser-1.7.jar");
	printf("\t\t unpacking $src\n");
	system("unzip -qo $corpusdir/compressed/$src -d $corpusdir/src\n") == 0 or die "Failed to extract $src\n";
	printf("\t\t unpacking $bin\n");
	system("unzip -qo $corpusdir/compressed/$bin @files -d $corpusdir/bin\n") == 0 or die "Failed to extract $bin\n";
}

sub list_names {
	my ($appverdir) = @_;
	opendir(COMPRESSED, "$appverdir/compressed") || die "can't open $appverdir/compressed: $!";
	my @archives = grep {! /^\.$/ and ! /^\.\.$/ } readdir(COMPRESSED);
	close(COMPRESSED);
	return @archives;
}
