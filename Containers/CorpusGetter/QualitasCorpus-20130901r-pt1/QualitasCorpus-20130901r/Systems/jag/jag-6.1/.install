#!/usr/bin/perl -w

use strict;

if ($ARGV[0] eq "-list") {
	my @list = list_names($ARGV[1]);
	printf("@list");
} elsif ($ARGV[0] eq "-reduced") {
	my $destination = $ARGV[1];
	install_reduced($destination);
} else {
	my $destination = $ARGV[0];
	install_reduced($destination);
}

sub install_reduced {
	my ($corpusdir) = @_;
	my $src = "jag-6.1-src.zip";
	my $bin = "jag-6.1.zip";
	my @files = ("jag-6.1/lib/c3p0-0.9.0.jar","jag-6.1/lib/commons-attributes-compiler-2.1.jar","jag-6.1/lib/commons-net-1.4.1.jar","jag-6.1/lib/hsqldb-1.7.3.3.jar","jag-6.1/lib/postgresql-8.0-312.jdbc3.jar","jag-6.1/lib/generic-exceptions-struts-1.2.jar","jag-6.1/lib/standard-1.1.2.jar","jag-6.1/lib/acegi-security-1.0.0-RC2.jar","jag-6.1/lib/commons-codec-1.3.jar","jag-6.1/lib/ejb3-persistence-3.1beta8.jar","jag-6.1/lib/xdoclet-bea-module-1.2-patch.jar","jag-6.1/lib/dom4j-1.6.1.jar","jag-6.1/lib/finalist-taglib-1.0.jar","jag-6.1/lib/emma_ant-2.0.5312.jar","jag-6.1/lib/statementexecutor-1.1.jar","jag-6.1/lib/xfire-all-1.0.jar","jag-6.1/lib/junit-3.8.1.jar","jag-6.1/lib/antlr-2.7.6.jar","jag-6.1/lib/sequencegenerator-ejb-1.0.jar","jag-6.1/lib/axis-saaj-1.2.jar","jag-6.1/lib/hibernate-tools-3.0.jar","jag-6.1/lib/commons-collections-3.1.jar","jag-6.1/lib/tapestry-contrib-4.0.1.jar","jag-6.1/lib/struts-1.2.4.jar","jag-6.1/lib/jakarta-regexp-1.3.jar","jag-6.1/lib/openide-lookup.jar","jag-6.1/lib/oro-2.0.8.jar","jag-6.1/lib/jmiutils.jar","jag-6.1/lib/geronimo-javamail_1.3.1_spec-1.0.jar","jag-6.1/lib/spring-1.2.6.jar","jag-6.1/lib/tapestry-portlet-4.0.1.jar","jag-6.1/lib/xdoclet-ejb-module-1.2.jar","jag-6.1/lib/commons-digester-1.7.jar","jag-6.1/lib/xdoclet-xdoclet-module-1.2.jar","jag-6.1/lib/commons-validator-1.1.3.jar","jag-6.1/lib/checkstyle-all-4.0-beta4.jar","jag-6.1/lib/finalist-ant-1.3.jar","jag-6.1/lib/commons-discovery-0.2.jar","jag-6.1/lib/emma-2.0.5312.jar","jag-6.1/lib/displaytag-1.1.jar","jag-6.1/lib/cglib-2.1_3.jar","jag-6.1/lib/poi-2.5.1.jar","jag-6.1/lib/xdoclet-apache-module-1.2.2.jar","jag-6.1/lib/hibernate-3.1.2.jar","jag-6.1/lib/commons-math-1.0.jar","jag-6.1/lib/commons-email-1.0.jar","jag-6.1/lib/commons-io-1.1.jar","jag-6.1/lib/axis-ant-1.2.jar","jag-6.1/lib/displaytag-export-poi-1.1.jar","jag-6.1/lib/hivemind-1.1.1.jar","jag-6.1/lib/xdoclet-jmx-module-1.2.jar","jag-6.1/lib/spring-mock-1.2.6.jar","jag-6.1/lib/jasperreports-1.2.0.jar","jag-6.1/lib/hibernate-annotations-3.1beta8.jar","jag-6.1/lib/itext-1.3.1.jar","jag-6.1/lib/xdoclet-oracle-module-1.2.jar","jag-6.1/lib/generic-exceptions-1.0.jar","jag-6.1/lib/jdt-compiler-3.1.1.jar","jag-6.1/lib/xbean-2.1.0.jar","jag-6.1/lib/commons-beanutils-1.7.0.jar","jag-6.1/lib/xjavadoc-1.0.2.jar","jag-6.1/lib/xdoclet-sun-module-1.2-cmr-patch.jar","jag-6.1/lib/quartz-1.5.1.jar","jag-6.1/lib/xdoclet-1.2.jar","jag-6.1/lib/nbmdr.jar","jag-6.1/lib/javassist-3.0.jar","jag-6.1/lib/jag.jar","jag-6.1/lib/sequencegenerator-ejb-1.0-sunone-client.jar","jag-6.1/lib/xdoclet-jboss-module-1.2.jar","jag-6.1/lib/castor-0.9.7.jar","jag-6.1/lib/ant-jmeter-2.0.3.jar","jag-6.1/lib/ognl-2.6.7.jar","jag-6.1/lib/xjavadoc-1.5-snapshot050611.jar","jag-6.1/lib/rome-0.8.jar","jag-6.1/lib/hivemind-lib-1.1.1.jar","jag-6.1/lib/andromda.jar","jag-6.1/lib/commons-httpclient-3.0.jar","jag-6.1/lib/jmi.jar","jag-6.1/lib/j2ee.jar","jag-6.1/lib/jstl-1.1.2.jar","jag-6.1/lib/mdrapi.jar","jag-6.1/lib/wstx-asl-2.9.1.jar","jag-6.1/lib/tacos4-beta-1-lib.jar","jag-6.1/lib/xfire-jsr181-api-1.0-M1.jar","jag-6.1/lib/log4j-1.2.8.jar","jag-6.1/lib/axis-1.2.jar","jag-6.1/lib/axis-jaxrpc-1.2.jar","jag-6.1/lib/tapestry-annotations-4.0.1.jar","jag-6.1/lib/ehcache-0.9.jar","jag-6.1/lib/ant-optional-1.5.3-1.jar","jag-6.1/lib/mof.jar","jag-6.1/lib/xbean-spring-2.2.jar","jag-6.1/lib/jaxen-1.1-beta-8.jar","jag-6.1/lib/velocity-dep-1.4.jar","jag-6.1/lib/wsdl4j-1.5.2.jar","jag-6.1/lib/asm-attrs-1.5.3.jar","jag-6.1/lib/xdoclet-hibernate-module-1.2.jar","jag-6.1/lib/commons-attributes-api-2.1.jar","jag-6.1/lib/simpleuml-1.0.1.jar","jag-6.1/lib/jfreechart-1.0.0.jar","jag-6.1/lib/stax-api-1.0.jar","jag-6.1/lib/commons-lang-2.1.jar","jag-6.1/lib/odmg-3.0.jar","jag-6.1/lib/commons-configuration-1.1.jar","jag-6.1/lib/geronimo-activation_1.0.2_spec-1.0.jar","jag-6.1/lib/xdoclet-web-module-1.2.jar","jag-6.1/lib/jfreechart-common-1.0.0.jar","jag-6.1/lib/jmiuml14di.jar","jag-6.1/lib/xdoclet-spring-module-1.2.2.jar","jag-6.1/lib/commons-fileupload-1.0.jar","jag-6.1/lib/tapestry-4.0.1.jar","jag-6.1/lib/jta1.0.1.jar","jag-6.1/lib/acegi-security-tiger-1.0.0-RC2.jar","jag-6.1/lib/asm-1.5.3.jar","jag-6.1/lib/errors-taglib-1.1.jar","jag-6.1/lib/hibernate-2.1.7c.jar","jag-6.1/lib/axis-wsdl4j-1.2.jar","jag-6.1/lib/commons-logging-1.0.4.jar","jag-6.1/lib/mysql-connector-java-3.1.12-bin.jar","jag-6.1/lib/jdbc2_0-stdext.jar","jag-6.1/lib/jdom-1.0.jar");
	printf("\t\t unpacking $src\n");
	system("unzip -qo $corpusdir/compressed/$src -d $corpusdir/src\n") == 0 or die "Failed to extract $src\n";
	printf("\t\t unpacking $bin\n");
	system("unzip -qo $corpusdir/compressed/$bin @files -d $corpusdir/bin\n") == 0 or die "Failed to extract $bin\n";
}

sub list_names {
	my ($appverdir) = @_;
	opendir(COMPRESSED, "$appverdir/compressed") || die "can't open $appverdir/compressed: $!";
	my @archives = grep {! /^\.$/ and ! /^\.\.$/ } readdir(COMPRESSED);
	close(COMPRESSED);
	return @archives;
}
