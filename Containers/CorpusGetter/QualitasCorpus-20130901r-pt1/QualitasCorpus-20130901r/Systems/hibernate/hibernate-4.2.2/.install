#!/usr/bin/perl -w

use strict;

if ($ARGV[0] eq "-list") {
	my @list = list_names($ARGV[1]);
	printf("@list");
} elsif ($ARGV[0] eq "-reduced") {
	my $destination = $ARGV[1];
	install_reduced($destination);
} else {
	my $destination = $ARGV[0];
	install_reduced($destination);
}

sub install_reduced {
	my ($corpusdir) = @_;
	my $src = "hibernate-release-4.2.2.Final.tgz";
	my $bin = "hibernate-release-4.2.2.Final.tgz";
	my @files = ("hibernate-release-4.2.2.Final/lib/jpa/hibernate-entitymanager-4.2.2.Final.jar","hibernate-release-4.2.2.Final/lib/required/jboss-logging-3.1.0.GA.jar","hibernate-release-4.2.2.Final/lib/optional/infinispan/hibernate-infinispan-4.2.2.Final.jar","hibernate-release-4.2.2.Final/lib/optional/infinispan/stax2-api-3.1.1.jar","hibernate-release-4.2.2.Final/lib/optional/ehcache/ehcache-core-2.4.3.jar","hibernate-release-4.2.2.Final/lib/optional/proxool/proxool-0.8.3.jar","hibernate-release-4.2.2.Final/lib/optional/proxool/hibernate-proxool-4.2.2.Final.jar","hibernate-release-4.2.2.Final/lib/required/dom4j-1.6.1.jar","hibernate-release-4.2.2.Final/lib/optional/ehcache/hibernate-ehcache-4.2.2.Final.jar","hibernate-release-4.2.2.Final/lib/required/jboss-transaction-api_1.1_spec-1.0.1.Final.jar","hibernate-release-4.2.2.Final/lib/optional/c3p0/c3p0-0.9.1.jar","hibernate-release-4.2.2.Final/lib/required/hibernate-jpa-2.0-api-1.0.1.Final.jar","hibernate-release-4.2.2.Final/lib/optional/infinispan/rhq-pluginAnnotations-3.0.4.jar","hibernate-release-4.2.2.Final/lib/optional/infinispan/hibernate-infinispan-4.2.2.Final-tests.jar","hibernate-release-4.2.2.Final/lib/required/antlr-2.7.7.jar","hibernate-release-4.2.2.Final/lib/optional/infinispan/staxmapper-1.1.0.Final.jar","hibernate-release-4.2.2.Final/lib/envers/hibernate-envers-4.2.2.Final.jar","hibernate-release-4.2.2.Final/lib/required/hibernate-core-4.2.2.Final.jar","hibernate-release-4.2.2.Final/lib/optional/infinispan/jboss-marshalling-river-1.3.15.GA.jar","hibernate-release-4.2.2.Final/lib/optional/infinispan/jgroups-3.2.0.CR1.jar","hibernate-release-4.2.2.Final/lib/required/hibernate-commons-annotations-4.0.2.Final.jar","hibernate-release-4.2.2.Final/lib/optional/infinispan/jboss-logging-3.1.1.GA.jar","hibernate-release-4.2.2.Final/lib/optional/ehcache/slf4j-api-1.6.1.jar","hibernate-release-4.2.2.Final/lib/optional/infinispan/woodstox-core-asl-4.1.1.jar","hibernate-release-4.2.2.Final/lib/optional/infinispan/infinispan-core-5.2.0.Beta3.jar","hibernate-release-4.2.2.Final/lib/required/javassist-3.15.0-GA.jar","hibernate-release-4.2.2.Final/lib/optional/c3p0/hibernate-c3p0-4.2.2.Final.jar","hibernate-release-4.2.2.Final/project/gradle/wrapper/gradle-wrapper.jar","hibernate-release-4.2.2.Final/lib/optional/infinispan/jboss-marshalling-1.3.15.GA.jar");
	printf("\t\t unpacking $src\n");
	system("tar zxf $corpusdir/compressed/$src -C $corpusdir/src\n") == 0 or die "Failed to extract $src\n";
	printf("\t\t unpacking $bin\n");
	system("tar zxf $corpusdir/compressed/$bin -C $corpusdir/bin @files\n") == 0 or die "Failed to extract $bin\n";
}

sub list_names {
	my ($appverdir) = @_;
	opendir(COMPRESSED, "$appverdir/compressed") || die "can't open $appverdir/compressed: $!";
	my @archives = grep {! /^\.$/ and ! /^\.\.$/ } readdir(COMPRESSED);
	close(COMPRESSED);
	return @archives;
}
